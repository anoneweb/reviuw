<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Admin Ulasan</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
    button { padding: 6px 12px; margin: 5px; }
    .ulasan-item { border-bottom: 1px solid #ccc; padding: 10px 0; }
    .rating-stars { color: #f39c12; }
    .reply { background: #f9f9f9; margin-top: 6px; padding: 6px; font-style: italic; }
  </style>
</head>
<body>
  <h1>Dashboard Admin</h1>

  <div id="user-info" style="margin-bottom: 20px;"></div>
  <button id="loginBtn">Login dengan Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <div id="admin-panel" style="display:none;">
    <h2>Daftar Ulasan</h2>
    <div id="reviews"></div>
  </div>

  <script>
    // Ganti dengan config Firebase kamu
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('user-info');
    const adminPanel = document.getElementById('admin-panel');
    const reviewsDiv = document.getElementById('reviews');

    loginBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(console.error);
    });

    logoutBtn.addEventListener('click', () => {
      auth.signOut();
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        userInfo.textContent = `Selamat datang, ${user.displayName} (${user.email})`;
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        adminPanel.style.display = 'block';
        loadReviews();
      } else {
        userInfo.textContent = '';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        adminPanel.style.display = 'none';
        reviewsDiv.innerHTML = '';
      }
    });

    // Load dan tampilkan ulasan
    function loadReviews() {
      db.collection('reviews').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
        reviewsDiv.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const id = doc.id;
          const stars = '‚≠ê'.repeat(data.rating);
          const comment = data.comment;
          const reply = data.reply || '';

          const reviewEl = document.createElement('div');
          reviewEl.classList.add('ulasan-item');
          reviewEl.innerHTML = `
            <div><strong>ID:</strong> ${id}</div>
            <div class="rating-stars">${stars}</div>
            <div><strong>Komentar:</strong> ${comment}</div>
            <div>
              <label>Balas: </label>
              <input type="text" id="reply-${id}" value="${reply}" style="width:70%" />
              <button onclick="saveReply('${id}')">Simpan</button>
              <button onclick="deleteReview('${id}')">Hapus</button>
            </div>
            ${reply ? `<div class="reply"><strong>Balasan:</strong> ${reply}</div>` : ''}
          `;
          reviewsDiv.appendChild(reviewEl);
        });
      });
    }

    window.saveReply = async (id) => {
      const input = document.getElementById('reply-' + id);
      const newReply = input.value.trim();
      try {
        await db.collection('reviews').doc(id).update({ reply: newReply });
        alert('Balasan berhasil disimpan.');
      } catch (e) {
        alert('Gagal menyimpan balasan: ' + e.message);
      }
    };

    window.deleteReview = async (id) => {
      if (confirm('Yakin ingin menghapus ulasan ini?')) {
        try {
          await db.collection('reviews').doc(id).delete();
          alert('Ulasan berhasil dihapus.');
        } catch (e) {
          alert('Gagal menghapus ulasan: ' + e.message);
        }
      }
    };
  </script>
</body>
</html>
