<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ulasan Pelanggan</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
    label { display: block; margin-top: 1rem; }
    textarea { width: 100%; height: 80px; }
    .review { border-bottom: 1px solid #ccc; padding: 1rem 0; }
    .stars { color: gold; }
    .average { font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem; }
  </style>
</head>
<body>

  <h1>Ulasan Pelanggan</h1>

  <div class="average" id="averageRating">Rata-rata Rating: --</div>

  <form id="reviewForm">
    <label>
      Nama: <br />
      <input type="text" id="name" required />
    </label>
    <label>
      Rating: <br />
      <select id="rating" required>
        <option value="">Pilih rating</option>
        <option value="5">⭐️⭐️⭐️⭐️⭐️</option>
        <option value="4">⭐️⭐️⭐️⭐️</option>
        <option value="3">⭐️⭐️⭐️</option>
        <option value="2">⭐️⭐️</option>
        <option value="1">⭐️</option>
      </select>
    </label>
    <label>
      Komentar: <br />
      <textarea id="comment" required></textarea>
    </label>
    <button type="submit">Kirim Ulasan</button>
  </form>

  <h2>Daftar Ulasan</h2>
  <div id="reviews"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBdyUz-FosHTjNJIy9E-rQzuAGDcPwKCc8",
  authDomain: "riviuw-718ee.firebaseapp.com",
  projectId: "riviuw-718ee",
  storageBucket: "riviuw-718ee.firebasestorage.app",
  messagingSenderId: "52069562774",
  appId: "1:52069562774:web:c0b3cbd6c01dcdbc3b05b7",
  measurementId: "G-0CRJTCHWSV"
};

    // Init Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const reviewForm = document.getElementById('reviewForm');
    const reviewsDiv = document.getElementById('reviews');
    const averageRatingDiv = document.getElementById('averageRating');

    // Submit form
    reviewForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const rating = parseInt(document.getElementById('rating').value);
      const comment = document.getElementById('comment').value.trim();

      if (!name || !rating || !comment) {
        alert('Mohon isi semua kolom');
        return;
      }

      // Simpan ke Firestore
      await db.collection('reviews').add({
        name,
        rating,
        comment,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      reviewForm.reset();
    });

    // Fungsi tampilkan rating bintang
    function starDisplay(rating) {
      return '⭐️'.repeat(rating) + '☆'.repeat(5 - rating);
    }

    // Tampilkan semua ulasan dan rata-rata secara realtime
    db.collection('reviews')
      .orderBy('timestamp', 'desc')
      .onSnapshot((snapshot) => {
        let reviewsHtml = '';
        let totalRating = 0;
        let count = 0;

        snapshot.forEach(doc => {
          const data = doc.data();
          reviewsHtml += `
            <div class="review">
              <strong>${data.name}</strong> - <span class="stars">${starDisplay(data.rating)}</span><br/>
              <p>${data.comment}</p>
            </div>
          `;
          totalRating += data.rating;
          count++;
        });

        reviewsDiv.innerHTML = reviewsHtml;

        if (count > 0) {
          const avg = (totalRating / count).toFixed(2);
          averageRatingDiv.textContent = `Rata-rata Rating: ${avg} ⭐️`;
        } else {
          averageRatingDiv.textContent = 'Rata-rata Rating: --';
        }
      });
  </script>

</body>
</html>
